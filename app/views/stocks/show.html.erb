<div class="container mt-4">
  <div class="row">
    <div class="col-md-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1><%= @stock.symbol %> - <%= @stock.name %></h1>
        <%= link_to 'Back to Portfolio', stocks_path, class: 'btn btn-secondary' %>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">Current Stock Information</h5>
            </div>
            <div class="card-body">
              <% if @live_data && !@live_data[:error] %>
                <div class="row">
                  <div class="col-sm-6">
                    <p><strong>Symbol:</strong> <%= @live_data[:symbol] %></p>
                    <p><strong>Current Price:</strong> $<%= number_with_precision(@live_data[:price], precision: 2) %></p>
                    <p><strong>Open:</strong> $<%= number_with_precision(@live_data[:open], precision: 2) if @live_data[:open] %></p>
                  </div>
                  <div class="col-sm-6">
                    <p><strong>High:</strong> $<%= number_with_precision(@live_data[:high], precision: 2) if @live_data[:high] %></p>
                    <p><strong>Low:</strong> $<%= number_with_precision(@live_data[:low], precision: 2) if @live_data[:low] %></p>
                    <p><strong>Volume:</strong> <%= number_with_delimiter(@live_data[:volume]) if @live_data[:volume] %></p>
                  </div>
                </div>
              <% else %>
                <div class="alert alert-warning">
                  <h6>Unable to fetch live data</h6>
                  <p class="mb-0">
                    <% if @live_data && @live_data[:error] %>
                      Error: <%= @live_data[:error] %>
                    <% else %>
                      No live data available at the moment.
                    <% end %>
                  </p>
                </div>
                <p><strong>Last Known Price:</strong> $<%= number_with_precision(@stock.price, precision: 2) %></p>
              <% end %>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">Portfolio Information</h5>
            </div>
            <div class="card-body">
              <p><strong>Added to Portfolio:</strong> <%= @stock.created_at.strftime("%B %d, %Y at %I:%M %p") %></p>
              <p><strong>Last Updated:</strong> <%= @stock.updated_at.strftime("%B %d, %Y at %I:%M %p") %></p>
              
              <div class="mt-4">
                <%= link_to 'Remove from Portfolio', stock_path(@stock), 
                    method: :delete, 
                    data: { 
                      confirm: 'Are you sure you want to remove this stock from your portfolio?',
                      turbo_method: :delete 
                    }, 
                    class: 'btn btn-danger' %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-4">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">Actions</h5>
            </div>
            <div class="card-body">
              <div class="d-grid gap-2 d-md-block">
                <%= link_to 'Refresh Data', stock_path(@stock), class: 'btn btn-info' %>
                <%= link_to 'View All Stocks', stocks_path, class: 'btn btn-primary' %>
                <%= link_to 'Add Another Stock', new_stock_path, class: 'btn btn-success' %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
